String.prototype.escapeHTML=function(){return(this.replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;"))};var cols={},messageIsOpen=false;$(function(){startTime(1);$("input").attr("autocomplete","off");$(window).hashchange(function(){var b=location.hash.replace(/^#/,"");if(b===""){$(".trigger-message-close").trigger("click")}});initScrollbar("#perfectScrollbar");$(window).hashchange();var a=$("#"+GetNav);if(!a.is(":visible")){a.parent().prev("a").trigger("click")}a.addClass("active");initOverlays();detectHash()});function initOverlays(){cols.showOverlay=function(){$("body").addClass("show-main-overlay")};cols.hideOverlay=function(){$("body").removeClass("show-main-overlay")};cols.showMessage=function(){$("body").addClass("show-message");messageIsOpen=true};cols.hideMessage=function(){$("body").removeClass("show-message");messageIsOpen=false};cols.showSidebar=function(){$("body").addClass("show-sidebar")};cols.hideSidebar=function(){$("body").removeClass("show-sidebar")};$(".trigger-toggle-sidebar").on("click",function(){cols.showSidebar();cols.showOverlay()});$(".trigger-message-close").on("click",function(){var a=$(this).closest(".messageFly");if($(".messageFly").length<=1){cols.hideMessage();a.remove();history.pushState("",document.title,window.location.pathname)}else{a.animate({left:"9999px"},function(){a.remove()})}});$("#main > .overlay").on("click",function(){cols.hideOverlay();cols.hideMessage();cols.hideSidebar()})}function detectHash(){var a=window.location.hash;if(!a.length){return false}$("[data-hash="+a.replace("#","")+"]").trigger("click")}$(document).on("click",".removeFromList",function(d){d.preventDefault();var b=$(this);var a=b.attr("data-table");if(typeof a==="undefined"||!a.length){openNoty("error","No 'data-table' attribute found, please specify it when creating the table row.");return false}var f=b.attr("data-id");if(typeof f==="undefined"||!f.length){openNoty("error","No 'data-id' attribute found, please specify it when creating the table row.");return false}var c=b.attr("data-endpoint");if(typeof c==="undefined"||!c.length){openNoty("error","No 'data-endpoint' attribute found, please specify it when creating the table row.");return false}var g=new Noty({text:"Do you want to remove entry #"+b.attr("data-id")+"?",type:"warning",buttons:[Noty.button("YES","btn btn-success pointer",function(){$.ajax({type:"GET",url:"ajax/requests.php",data:{endpoint:c,values:{table:a,id:f}},success:function(e){if(e.result==="success"){if(typeof e.extra.action!=="undefined"&&e.extra.action==="remove"){$("#row_"+e.extra.id).remove()}}else{openNoty(e.result,e.message)}g.close()},fail:function(e){openNoty("error","Failed to delete row!");g.close()}})}),Noty.button("NO","btn btn-danger pointer",function(){g.close()})]}).show()});$(document).on("click",".toggleTree",function(b){b.preventDefault();var c=$(this).next(".treeMenu");var a=$(this).children("i");if(c.is(":visible")){a.removeClass("fa-chevron-down").addClass("fa-chevron-right")}else{a.removeClass("fa-chevron-right").addClass("fa-chevron-down")}c.toggle(200)});$(document).on("click",".clickable",function(c){c.preventDefault();window.location.hash=$(this).attr("data-hash");var b=Math.floor((Math.random()*10000)+1);$("body").append('<div class="messageFly" id="'+b+'"></div>');var a=$("#"+b);a.show();loadDetails($(this),b);if(messageIsOpen){if(!$(this).hasClass("innerMessage")){cols.hideMessage()}setTimeout(function(){cols.showMessage()},300)}else{cols.showMessage()}cols.showOverlay()});function loadDetails(b,c){var a=$("#"+c);a.html('<i class="fa fa-spin fa-spinner fa-4x"></i>');$.get(b.attr("href")).done(function(d){a.html(d);initOverlays();initScrollbar(".subScroll")})}$(document).on("click","#updateEntry",function(d){d.preventDefault();var c=$(this);var a=c.html();if(c.hasClass("disabled")){return false}c.addClass("disabled").html('<i class="fa fa-spin fa-spinner"></i>');var b=[];$(".sendValueUpdate").each(function(k,g){var e=$(g).attr("data-name");var h=$(g).val();var f=$(g).attr("type");var j=$(g).attr("data-required");var m=$(g).attr("data-col");var l={name:e,val:h,type:f,required:j,col:m};b.push(l)});$.ajax({type:"GET",url:"/ajax/requests.php",data:{values:b,endpoint:c.attr("data-endpoint"),table:c.attr("data-table"),id:c.attr("data-id")},success:function(e){openNoty(e.result,e.message);if(e.result==="success"){if(typeof e.extra.fields==="undefined"){openNoty("error","Missing 'fields' in response, please check the correct format first.");return false}$.each(e.extra.fields,function(g,f){$("#field_"+f.field+"_"+e.extra.id).html(f.value)})}},fail:function(e){openNoty("error","failed to save entry, please try again!")},complete:function(){c.removeClass("disabled").html(a)}})});$(document).on("click","#addEntry",function(a){a.preventDefault();addEntry($(this))});function addEntry(a){var b='<div class="row">\n       <div class="col-12">\n               <div class="card cardTransparent">\n                       <div class="card-body">\n                               <div class="row">\n                                       <div class="col-12">\n                                               <h4 class="card-title">'+a.attr("data-add-heading")+'</h4>\n                                               <h6 class="card-subtitle mb-2 text-muted">&nbsp;</h6>\n                                       </div>\n                               </div>\n                               <div class="row">\n                                       <div class="col-12" id="loadForm">\n                                               <i class="fa fa-spin fa-spinner"></i>\n                                       </div>\n                               </div>\n                       </div>\n               </div>\n       </div>\n</div>\n';var c=new Noty({layout:"center",text:b,type:"alert",timeout:false,theme:"mint",modal:true,closeWith:["button"],buttons:[Noty.button("Save","btn btn-success btn-sm rounded-0 btn-block pointer saveModal",function(){var g=$(this)[0]["id"];var f=$("#"+g);var d=f.html();if(f.hasClass("disabled")){return false}f.addClass("disabled").html('<i class="fa fa-spin fa-spinner"></i>');var e=[];$(".sendValue").each(function(n,k){var h=$(k).attr("data-name");var l=$(k).val();var j=$(k).attr("type");var m=$(k).attr("data-required");var p=$(k).attr("data-col");var o={name:h,val:l,type:j,required:m,col:p};e.push(o)});$.ajax({type:"GET",url:"/ajax/requests.php",data:{values:e,endpoint:a.attr("data-endpoint"),table:a.attr("data-table")},success:function(i){openNoty(i.result,i.message);if(i.result==="success"){var j=$("#"+a.attr("data-tbody-id"));if(typeof i.extra.fields==="undefined"){openNoty("error","Missing 'fields' in response, please check the correct format first.");return false}var h=$('<tr id="row_'+i.extra.id+'"></tr>');h.append("<td>"+i.extra.id+"</td>");$.each(i.extra.fields,function(l,k){if(k.field!=="project_id"){if(k.type==="password"){h.append("<td>***</td>")}else{if(k.type==="checkbox"){if(k.value==="true"){h.append('<td><i class="fa fa-check"></i></td>')}else{h.append('<td><i class="fa fa-remove"></i></td>')}}else{h.append("<td>"+k.value+"</td>")}}}});h.append("<td>&nbsp;</td>");j.append(h)}c.close()},fail:function(h){openNoty("error","failed to save entry, please try again!")},complete:function(){f.removeClass("disabled").html(d)}})}),Noty.button("Close","btn btn-danger btn-sm rounded-0 btn-block pointer",function(){c.close()})]}).on("afterShow",function(){var d="none";if(typeof a.attr("data-id")!==typeof undefined&&a.attr("data-id")!==false){d=a.attr("data-id")}$.ajax({type:"GET",url:a.attr("data-url"),data:{template:a.attr("data-template"),id:d},success:function(e){$("#loadForm").html(e)},fail:function(e){openNoty("error","Error loading template, please try again.");c.close()}})}).show()}function openNoty(a,b){new Noty({layout:"topRight",text:b,type:a,timeout:3000,buttons:false}).show()}function initScrollbar(b){if($(b).length){var a=new PerfectScrollbar(b)}if($("#pScrollerMenu").length){var c=new PerfectScrollbar("#pScrollerMenu")}}function startTime(f){var b=new Date();var e=b.getHours();var a=b.getMinutes();var d=b.getSeconds();a=checkTime(a);d=checkTime(d);$("#startClock").html("@"+e+":"+a+":"+d+" Uhr");var c=setTimeout(startTime,1000)}function checkTime(a){if(a<10){a="0"+a}return a};